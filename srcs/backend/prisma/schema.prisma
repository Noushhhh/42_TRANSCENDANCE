generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                Int       @id @default(autoincrement())
  username          String    @unique
  hashPassword      String
  email             String?
  // firstName         String?
  // lastName          String?
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt
  avatar            String?
  gamesLost         Int       @default(0)
  gamesPlayed       Int       @default(0)
  gamesWon          Int       @default(0)
  level             Int       @default(0)
  playTime          Int       @default(0)
  rank              Int?
  channelsOwned     Channel[] @relation("Owner")
  sentMessages      Message[] @relation("MessagesSent")
  adminOfChannels   Channel[] @relation("Admins")
  bannedFromChannel Channel[] @relation("BannedUsers")
  users_A           User[]    @relation("BlockedUsers")
  users_B           User[]    @relation("BlockedUsers")
  mutedInChannels   Channel[] @relation("MutedUsers")
  conversations     Channel[] @relation("Participant")

  @@unique([id, username])
  @@map("users")
}

model Channel {
  id           Int         @id @default(autoincrement())
  name         String
  type         ChannelType @default(PUBLIC)
  password     String?     @default("")
  ownerId      Int
  owner        User        @relation("Owner", fields: [ownerId], references: [id])
  messages     Message[]   @relation("Channel")
  admins       User[]      @relation("Admins")
  bannedUsers  User[]      @relation("BannedUsers")
  mutedUsers   User[]      @relation("MutedUsers")
  participants User[]      @relation("Participant")
}

model Message {
  id        Int      @id @default(autoincrement())
  senderId  Int
  channelId Int
  content   String
  createdAt DateTime @default(now())
  channel   Channel  @relation("Channel", fields: [channelId], references: [id])
  sender    User     @relation("MessagesSent", fields: [senderId], references: [id])
}

enum ChannelType {
  PUBLIC
  PRIVATE
  PASSWORD_PROTECTED
}
